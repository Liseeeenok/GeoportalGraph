(function(){"use strict";var e={432:function(e,t,a){var l=a(9242),i=a(3396);const s={class:"container mt-4 p-4 text-center border"};function r(e,t,a,l,r,o){const d=(0,i.up)("graph-geoportal");return(0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(d)])}var o=a(7139);const d={class:"row row-cols-1 align-items-center justify-content-between"},n={key:0,class:"container col-lg-3"},c={class:"row row-cols-1 justify-content-center align-items-center"},h=(0,i._)("div",{class:"mb-1"}," Название графика: ",-1),p={class:"row row-cols-1 justify-content-center col-12 mb-1"},u={class:"row row-cols-2 mt-1"},g=(0,i._)("div",{class:"col pe-0 ps-0"},"Отображать с:",-1),f=(0,i._)("option",{disabled:"",value:""},"Выберите дату",-1),w=["value"],v=(0,i._)("div",{class:"col mt-1"},"по:",-1),y=(0,i._)("option",{disabled:"",value:""},"Выберите дату",-1),T=["value"],m={class:"row col-8 align-self-end mt-3"},D={class:"row col-8 align-self-end mt-3"},_={class:"row col-8 align-self-end mt-3"},b=(0,i._)("option",{disabled:"",value:""},"Выберите вид графика",-1),G=(0,i._)("option",{value:1},"Линейный график",-1),C=(0,i._)("option",{value:2},"Столбчатый график",-1),z=[b,G,C],x={key:1,class:"container row pe-0 ps-0 justify-content-center"},E={class:"mb-1 pt-2"},O={class:"row row-cols-2 justify-content-center col-12"},k=["onUpdate:modelValue","change"],I=["onChange","onUpdate:modelValue"],M=(0,i._)("option",{disabled:"",value:{data:""}},"Выберите территорию",-1),j=["value"],U={class:"row col-10 justify-content-center pe-0 ps-0 mt-1"},H=(0,i._)("div",{class:"row col-12 justify-content-center"},[(0,i._)("span",{class:"col-12"},"Вертикальные данные:")],-1),L={class:"row col-10 mt-1 pb-2"},F=["onChange","onUpdate:modelValue"],V=(0,i._)("option",{disabled:"",value:""},"Выберите параметр",-1),S=["value"],P={class:"row col-10 justify-content-center pe-0 ps-0 mt-1"},R=(0,i._)("div",{class:"row col-12 justify-content-center"},[(0,i._)("span",{class:"col-12"},"Горизонтальные данные:")],-1),$={class:"row col-10 mt-1 pb-2"},J=["onChange","onUpdate:modelValue"],K=(0,i._)("option",{disabled:"",value:""},"Выберите параметр",-1),N=["value"],Y={class:"row col-10 justify-content-center pe-0 ps-0 mt-1"},Q={class:"row col-10 mt-1 pb-2"},W={class:"row col-10 justify-content-center pe-0 ps-0 mt-1"},q={class:"row col-10 mt-1 pb-2"},A={key:2,class:"col-lg-12 fs-3 text"},Z={key:3,class:"row align-self-end mt-3 row-cols-1 col-lg-12"},B=(0,i._)("div",null,"Ссылка на график: ",-1),X={class:"btn btn-link mt-3"};function ee(e,t,a,s,r,b){const G=(0,i.up)("Line"),C=(0,i.up)("Bar");return(0,i.wg)(),(0,i.iD)("div",d,[(0,i.Wm)(G,{style:(0,o.j5)("1"==r.typeGraph?"display: block":"display: none"),class:(0,o.C_)(!1===r.idEx?"col-lg-9":"col-lg-12"),"chart-options":this.graph.chartOptions,"chart-data":this.graph.chartData,height:r.heightGraph},null,8,["style","class","chart-options","chart-data","height"]),(0,i.Wm)(C,{style:(0,o.j5)("2"==r.typeGraph?"display: block":"display: none"),class:(0,o.C_)(!1===r.idEx?"col-lg-9":"col-lg-12"),"chart-options":this.graph.chartOptions,"chart-data":this.graph.chartData,height:r.heightGraph},null,8,["style","class","chart-options","chart-data","height"]),!1===r.idEx?((0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("div",c,[h,(0,i._)("div",p,[(0,i.wy)((0,i._)("input",{placeholder:"Введите название графика","onUpdate:modelValue":t[0]||(t[0]=e=>this.selectedTitle=e)},null,512),[[l.nr,this.selectedTitle]])]),(0,i._)("div",u,[g,(0,i.wy)((0,i._)("select",{class:"col-6",onChange:t[1]||(t[1]=e=>{b.sliceLabelsGraph(),b.changeId()}),"onUpdate:modelValue":t[2]||(t[2]=e=>r.selectedFirstDate=e)},[f,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.arrDateGraph,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e,key:e},(0,o.zw)(e),9,w)))),128))],544),[[l.bM,r.selectedFirstDate]]),v,(0,i.wy)((0,i._)("select",{class:"col-6 mt-1",onChange:t[3]||(t[3]=e=>{b.sliceLabelsGraph(),b.changeId()}),"onUpdate:modelValue":t[4]||(t[4]=e=>r.selectedEndDate=e)},[y,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.arrDateGraph,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e,key:e},(0,o.zw)(e),9,T)))),128))],544),[[l.bM,r.selectedEndDate]])]),(0,i._)("div",m,[(0,i._)("button",{onClick:t[5]||(t[5]=e=>{b.addGraph(),b.changeId()}),class:"p-2 btn btn-outline-primary"},"Добавить график")]),(0,i._)("div",D,[(0,i._)("button",{onClick:t[6]||(t[6]=e=>b.generationId()),class:"p-2 btn btn-outline-primary"},"Сохранить график")]),(0,i._)("div",_,[(0,i.wy)((0,i._)("select",{class:"col-12 mt-1","onUpdate:modelValue":t[7]||(t[7]=e=>r.typeGraph=e),onChange:t[8]||(t[8]=e=>b.changeId())},z,544),[[l.bM,r.typeGraph]])])])])):(0,i.kq)("",!0),!1===r.idEx?((0,i.wg)(),(0,i.iD)("div",x,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.countGraph,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e-1,class:"row justify-content-center align-items-center col-12 col-sm-6 col-md-4 col-lg-3 border rounded ms-3 mt-1 pe-1 ps-1"},[(0,i._)("div",E," Цвет графика №"+(0,o.zw)(e)+": ",1),(0,i._)("div",O,[(0,i.wy)((0,i._)("input",{type:"color",class:"form-control form-control-color","onUpdate:modelValue":t=>r.selectedColor[e-1]=t,change:b.changeColor(e-1)},null,8,k),[[l.nr,r.selectedColor[e-1]]])]),(0,i.wy)((0,i._)("select",{class:"col-12 mt-1",onChange:t=>{b.redrawGraph(e-1),b.changeId()},"onUpdate:modelValue":t=>r.selectedTer[e-1]=t},[M,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.arrTer,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e.id,value:e},(0,o.zw)(e.name),9,j)))),128))],40,I),[[l.bM,r.selectedTer[e-1]]]),(0,i._)("div",U,[H,(0,i._)("div",L,[(0,i.wy)((0,i._)("select",{onChange:t=>{b.redrawGraph(e-1),b.changeId()},"onUpdate:modelValue":t=>r.selectedMean[e-1].data=t},[V,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.arrQuality,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e.fieldname,value:e.fieldname},(0,o.zw)(e.title),9,S)))),128))],40,F),[[l.bM,r.selectedMean[e-1].data]])])]),(0,i._)("div",P,[R,(0,i._)("div",$,[(0,i.wy)((0,i._)("select",{onChange:t=>{b.redrawGraph(e-1),b.changeId()},"onUpdate:modelValue":t=>r.selectedHorizontal[e-1].data=t},[K,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.arrQuality,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e.fieldname,value:e.fieldname},(0,o.zw)(e.title),9,N)))),128))],40,J),[[l.bM,r.selectedHorizontal[e-1].data]])])]),(0,i._)("div",Y,[(0,i._)("div",Q,[(0,i.wy)((0,i._)("input",{placeholder:"Вертикальная подпись","onUpdate:modelValue":t[9]||(t[9]=e=>this.verticalTitle=e)},null,512),[[l.nr,this.verticalTitle]])])]),(0,i._)("div",W,[(0,i._)("div",q,[(0,i.wy)((0,i._)("input",{placeholder:"Горизонтальная подпись","onUpdate:modelValue":t[10]||(t[10]=e=>this.gorizontalTitle=e)},null,512),[[l.nr,this.gorizontalTitle]])])])])))),128))])):(0,i.kq)("",!0),null===r.idEx?((0,i.wg)(),(0,i.iD)("div",A," Графика с таким id не существует ")):(0,i.kq)("",!0),r.URLforSave?((0,i.wg)(),(0,i.iD)("div",Z,[B,(0,i._)("button",X,(0,o.zw)(r.URLforSave),1)])):(0,i.kq)("",!0)])}var te=a(6265),ae=a.n(te),le=a(6294),ie=a(741);ie.kL.register(ie.Dx,ie.u,ie.De,ie.ZL,ie.uw,ie.f$,ie.jn,ie.od,ie.Gu);var se={components:{Bar:le.$Q,Line:le.x1},data(){return{typeGraph:1,countGraph:1,selectedFirstDate:"",selectedEndDate:"",selectedTitle:"",standartColor:"#0d6efd",selectedColor:["#0d6efd"],idPage:"",idEx:void 0,selectedMean:[{data:""}],selectedHorizontal:[{data:""}],selectedTer:[{data:""}],arrTer:[],iDisplayLength:3061,baseURL:"http://cris.icc.ru/dataset/list?f=1875&count_rows=true&iDisplayStart=0",arrQuality:[],heightGraph:200,arrDateGraph:[],labelsGraph:[],dataGraph:[[]],gorizontalTitle:"",verticalTitle:"",graph:{chartData:{labels:[],datasets:[{label:"",data:[],fill:!0,borderColor:"",borderWidth:1}]},chartOptions:{responsive:!0,plugins:{title:{display:!0,text:"",font:{size:20}}},scales:{x:{display:!0,title:{display:!0,text:""}},y:{display:!0,title:{display:!0,text:""}}}}},URLforSave:""}},methods:{changeId(){this.URLforSave=!1},redrawGraph(e){let t="";const a=this.selectedTer[e].data,l=[],i=[],s=[],r=this.selectedMean[e].data,o=this.selectedHorizontal[e].data;a.sort(((e,t)=>e.w_date<t.w_date?-1:e.w_date>t.w_date?1:void 0)),a.map((a=>{if(null!==a.w_date&&null!==a[r]&&null!==a[o])return s.push(a.w_date),t=this.selectedMean[e].data+" "+a.wmoid.name,l.push(a[o]),void i.push(a[r])})),this.graph.chartData.datasets[e].label=t,""==this.gorizontalTitle?(this.gorizontalTitle=o,this.graph.chartOptions.scales.x.title.text=o):this.graph.chartOptions.scales.x.title.text=this.gorizontalTitle,""==this.verticalTitle?(this.verticalTitle=r,this.graph.chartOptions.scales.y.title.text=r):this.graph.chartOptions.scales.y.title.text=this.verticalTitle,this.labelsGraph=l,this.arrDateGraph=s,this.dataGraph[e]=i,this.sliceLabelsGraph()},async getDataAPI(){try{const e=[],t=await ae().get("http://cris.icc.ru/dataset/list?f=100&f_id=1875"),a=JSON.parse(t.data.aaData[0].JSON).columns;a.forEach((e=>{e.visible&&this.arrQuality.push(e)}));const l=await ae().get(this.baseURL+"&iDisplayLength="+this.iDisplayLength),i=l.data.aaData;i.map((t=>{if(!e.includes(t.wmoid.id)&&null!==t.wmoid.name){const a=t.wmoid.id,l=t.wmoid.name,i={};i.id=a,i.name=l,i.data=[],this.arrTer.push(i),e.push(a)}this.arrTer.map((e=>{e.id==t.wmoid.id&&e.data.push(t)}))}))}catch(e){alert("Error: "+e)}},async createFirstGraph(){const e=Object.fromEntries(new URL(window.location).searchParams.entries());if(e.id&&""!==e.id){this.idPage=e.id;const t=a(7303).r,l=t.find((e=>e.id==this.idPage));void 0!==l?(await this.getDataAPI(),this.selectedTer=[],l.arrIdTer.forEach(((e,t)=>{this.selectedTer.push(this.arrTer.find((t=>t.id==e)))})),console.log(this.selectedTer),this.selectedMean=l.selectedMean,this.selectedHorizontal=l.selectedHorizontal,this.selectedColor=l.selectedColor,console.log(this.selectedColor),console.log(l.selectedColor),this.gorizontalTitle=l.gorizontalTitle,this.verticalTitle=l.verticalTitle,this.selectedFirstDate=l.selectedFirstDate,this.selectedEndDate=l.selectedEndDate,this.selectedTitle=l.selectedTitle,this.typeGraph=l.typeGraph,l.arrIdTer.forEach(((e,t)=>{t>0&&this.addGraph(),this.redrawGraph(t),console.log(this.selectedColor),console.log(l.selectedColor),this.changeColor(t)}))):this.idEx=null}else this.idEx=!1,this.selectedColor[0]=JSON.parse(JSON.stringify(this.standartColor)),await this.getDataAPI()},generationId(){const e={},t=`${this.selectedTer[0].id}${this.selectedMean[0].data}${Date.now()}`;this.graph;let a=[];this.selectedTer.forEach((e=>{a.push(e.id)})),e.id=t,e.arrIdTer=a,e.selectedMean=this.selectedMean,e.selectedHorizontal=this.selectedHorizontal,e.selectedColor=this.selectedColor,e.gorizontalTitle=this.gorizontalTitle,e.verticalTitle=this.verticalTitle,e.selectedFirstDate=this.selectedFirstDate,e.selectedEndDate=this.selectedEndDate,e.selectedTitle=this.selectedTitle,e.typeGraph=this.typeGraph,this.URLforSave=`${window.location.origin}/?id=${t}`,console.log(JSON.stringify(e))},changeColor(e){this.graph.chartData.datasets[e].borderColor=this.selectedColor[e]},changeLabel(){this.graph.chartOptions.plugins.title.text=this.selectedTitle},sliceLabelsGraph(){if(""!==this.selectedFirstDate&&""!==this.selectedEndDate){const e=this.arrDateGraph.indexOf(this.selectedFirstDate),t=this.arrDateGraph.indexOf(this.selectedEndDate);this.graph.chartData.labels=this.labelsGraph.slice(e,t+1),this.dataGraph.forEach(((a,l)=>this.graph.chartData.datasets[l].data=a.slice(e,t+1))),console.log(this.graph.chartData.labels),console.log(this.graph.chartData.datasets[0].data)}},addGraph(){this.selectedColor[this.countGraph]||(this.selectedColor[this.countGraph]=this.standartColor),this.selectedMean.push({data:""}),this.selectedTer.push({data:""}),this.selectedHorizontal.push({data:""}),this.dataGraph[this.countGraph]=[],this.graph.chartData.datasets.push({fill:!0,label:"",data:[],borderColor:"",borderWidth:1}),this.countGraph++},changeTypeGraph(e){this.typeGraph=e}},created(){this.createFirstGraph()},watch:{selectedTitle:function(){this.graph.chartOptions.plugins.title.text=this.selectedTitle,this.changeId()},gorizontalTitle:function(){this.graph.chartOptions.scales.x.title.text=this.gorizontalTitle,this.changeId()},verticalTitle:function(){this.graph.chartOptions.scales.y.title.text=this.verticalTitle,this.changeId()}}},re=a(89);const oe=(0,re.Z)(se,[["render",ee]]);var de=oe,ne={components:{GraphGeoportal:de}};const ce=(0,re.Z)(ne,[["render",r]]);var he=ce;const pe=(0,l.ri)(he);pe.mount("#app")},7303:function(e){e.exports=JSON.parse('{"r":[{"id":"0","arrIdTer":[30712,30731],"selectedMean":[{"data":"t"},{"data":"t"}],"selectedHorizontal":[{"data":"w_date"},{"data":"w_date"}],"selectedColor":[["#0d6efd"],"#47bf45"],"gorizontalTitle":"8910","verticalTitle":"567","selectedFirstDate":"2020-11-01 02:00:00","selectedEndDate":"2020-11-03 11:00:00","selectedTitle":"1234","typeGraph":1},{"id":"1","arrIdTer":[30712,30731],"selectedMean":[{"data":"po"},{"data":"po"}],"selectedHorizontal":[{"data":"w_date"},{"data":"w_date"}],"selectedColor":["#1dfd0d","#fd0d0d"],"gorizontalTitle":"w_date","verticalTitle":"po","selectedFirstDate":"2020-11-01 02:00:00","selectedEndDate":"2020-11-03 08:00:00","selectedTitle":"Давление Тест","typeGraph":2},{"id":"2","arrIdTer":[30712,30622,30405],"selectedMean":[{"data":"t"},{"data":"t"},{"data":"t"}],"selectedHorizontal":[{"data":"w_date"},{"data":"w_date"},{"data":"w_date"}],"selectedColor":["#0d6efd","#f96401","#00ff1e"],"gorizontalTitle":"Тест горизонтальный","verticalTitle":"Тест вертикальный","selectedFirstDate":"2020-11-01 02:00:00","selectedEndDate":"2020-11-03 17:00:00","selectedTitle":"Температура тест","typeGraph":1},{"id":"3","arrIdTer":[30603,30526,29698],"selectedMean":[{"data":"ff"},{"data":"ff"},{"data":"ff"}],"selectedHorizontal":[{"data":"w_date"},{"data":"w_date"},{"data":"w_date"}],"selectedColor":["#0d6efd","#102442","#fd0d0d"],"gorizontalTitle":"w_date","verticalTitle":"ff","selectedFirstDate":"2020-11-01 02:00:00","selectedEndDate":"2020-11-04 14:00:00","selectedTitle":"Test","typeGraph":1},{"id":"30712t1670059072802","arrIdTer":[30712,30815,24817],"selectedMean":[{"data":"t"},{"data":"t"},{"data":"t"}],"selectedHorizontal":[{"data":"w_date"},{"data":"w_date"},{"data":"w_date"}],"selectedColor":["#e90c0c","#0d6efd","#22fa05"],"gorizontalTitle":"w_date","verticalTitle":"t","selectedFirstDate":"2020-11-06 05:00:00","selectedEndDate":"2020-11-10 23:00:00","selectedTitle":"Температура","typeGraph":1},{"id":"30712po1670137596700","arrIdTer":[30712,30824],"selectedMean":[{"data":"po"},{"data":"po"}],"selectedHorizontal":[{"data":"w_date"},{"data":"w_date"}],"selectedColor":["#0d6efd","#0dfd1d"],"gorizontalTitle":"ДАТА","verticalTitle":"ДАВЛЕНИЕ","selectedFirstDate":"2020-11-01 02:00:00","selectedEndDate":"2020-11-03 11:00:00","selectedTitle":"ДАВЛЕНИЕ 2","typeGraph":1}]}')}},t={};function a(l){var i=t[l];if(void 0!==i)return i.exports;var s=t[l]={exports:{}};return e[l](s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,l,i,s){if(!l){var r=1/0;for(c=0;c<e.length;c++){l=e[c][0],i=e[c][1],s=e[c][2];for(var o=!0,d=0;d<l.length;d++)(!1&s||r>=s)&&Object.keys(a.O).every((function(e){return a.O[e](l[d])}))?l.splice(d--,1):(o=!1,s<r&&(r=s));if(o){e.splice(c--,1);var n=i();void 0!==n&&(t=n)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[l,i,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,l){var i,s,r=l[0],o=l[1],d=l[2],n=0;if(r.some((function(t){return 0!==e[t]}))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(d)var c=d(a)}for(t&&t(l);n<r.length;n++)s=r[n],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(c)},l=self["webpackChunk"]=self["webpackChunk"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[998],(function(){return a(432)}));l=a.O(l)})();
//# sourceMappingURL=app.7393d939.js.map